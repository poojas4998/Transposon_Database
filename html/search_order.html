<!DOCTYPE html>
<html>
<head>
	<title>BF 768 Database Project</title>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href= "/Users/sveerisetti/Desktop/search_order/mycss.css">



	<title>Google Pie Chart Example</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript">

function google_piechart() {
    let tableChoice = $("#table_choice").val();
    //Clear out any previous visualizations from the divisions
    $("#pie_chart").empty()
    $("#data_table").empty()
    if (tableChoice == ""){
      alert("There is no text in the species name text box");
    }
    //We reference the Python Script that will give us the sorted transposon orders
    $.get("https://bioed.bu.edu/cgi-bin/students_23/sv/search_order.py",
    //Selector that matches Python server side script
        {selector: "piechart", table_choice: tableChoice},
        //Use the create_piechart function, which uses Google charts in order to produce our pie chart
        function (data) {
            create_piechart(data);
        },
        "json"
    );
}

function google_piechart_2() {
    let transposonChoice = $("#transposon_choice").val();
    $("#pie_chart_2").empty()
    $("#data_table_2").empty()
    if (transposonChoice == ""){
      alert("There is no text in the transposon choice text box");
    }
    $("#transposon_order_heading").text(`Occurences of ` + transposonChoice + ` within the Betta splendens, Takifugu rubripes, Heterocephalus
    glaber, and Homo sapiens species`);
    //We reference the Python Script that will give us the sorted transposon orders
    $.get("https://bioed.bu.edu/cgi-bin/students_23/sv/search_order_2.py",
    //Selector that matches server side script
        {selector: "piechart_specific", transposon_choice: transposonChoice},
        //Use the create_piechart function, which uses Google charts in order to produce our pie chart
        function (data2) {
            create_piechart_2(data2);
        },
        "json"
    );
}

let global_data1 = null; 
let global_data2 = null; 
let pieChart = null; 
let pieChart_2 = null;


//Code to create the first pie chart and table
function create_piechart(data) {
    global_data1 = data;
    if (data.length === 0) {
        alert('There was no data for the table choice.');
        return;
    }

    let formattedData = data.map(item => [item.Transposon_Order, item.Total]);
    //Add the table headers with Transposon_Order and Count
    formattedData.unshift(["Transposon_Order", "Count"]);
    //Create variable for the dashboard
    var dashboard = new google.visualization.Dashboard(
        document.getElementById('dashboard_div'));
    //Create variable for the slider for live filtering of count
    var filter_slider = new google.visualization.ControlWrapper({
        'controlType': 'NumberRangeFilter',
        'containerId': 'total_filter_slider',
        'options': {
            'filterColumnLabel': 'Count'
        }
    });
    // Create the pie chart with select options
    pieChart = new google.visualization.ChartWrapper({
        'chartType': 'PieChart',
        'containerId': 'pie_chart',
        'options': {
            'width': 600,
            'height': 700,
            'pieSliceText': 'value',
            'legend': 'right', 
            backgroundColor : 'transparent'
        }
    });
    // Create the table with select options
    var tableChart = new google.visualization.ChartWrapper({
        'chartType': 'Table',
        'containerId': 'data_table',
        'options': {
            'width': '80%',
            'height': '90%',
            'showRowNumber': false,
            'page': 'enable',
            'pageSize': 10, 
            backgroundColor : 'transparent'
        }
    });

    //Binding everything together to produce the dashboard
    dashboard.bind(filter_slider, pieChart);
    dashboard.bind(filter_slider, tableChart);

    var dataTable = google.visualization.arrayToDataTable(formattedData);
    dashboard.draw(dataTable);
}


//Code to create the second pie chart & table
function create_piechart_2(data2) {
    global_data2 = data2;
    if (data2.length === 0) {
        alert('There was no data for the table choice.');
        return;
    }

    let formattedData = data2.map(item => [String(item.Species), item.Count]);
    //Add the table header with Species & Count
    formattedData.unshift(["Species", "Count"]);
    var dashboard_2 = new google.visualization.Dashboard(
        document.getElementById('dashboard_div_2'));
    var filter_slider_2 = new google.visualization.ControlWrapper({
        'controlType': 'NumberRangeFilter',
        'containerId': 'total_filter_slider_2',
        'options': {
            'filterColumnLabel': 'Count'
        }
    });
    // Create the pie chart with specific options
    pieChart_2 = new google.visualization.ChartWrapper({
        'chartType': 'PieChart',
        'containerId': 'pie_chart_2',
        'options': {
            'width': 600,
            'height': 700,
            'pieSliceText': 'value',
            'legend': 'right', 
            backgroundColor : 'transparent'
        }
    });
    // Create the table with specific options
    var tableChart_2 = new google.visualization.ChartWrapper({
        'chartType': 'Table',
        'containerId': 'data_table_2',
        'options': {
            'width': '80%',
            'height': '90%',
            'showRowNumber': false,
            'page': 'enable',
            'pageSize': 10, 
            backgroundColor : 'transparent'
        }
    });

    pieChart_2.setOption('sliceVisibilityThreshold', 0);
    pieChart_2.setOption('legend', { position: 'right', alignment: 'center', textStyle: { fontSize: 14 } });
    pieChart_2.setOption('sliceNames', ['Betafish', 'HumanT2T', 'Molerat', 'Pufferfish']);

    dashboard_2.bind(filter_slider_2, pieChart_2);
    dashboard_2.bind(filter_slider_2, tableChart_2);

    var dataTable = google.visualization.arrayToDataTable(formattedData);
    dashboard_2.draw(dataTable);
}


function reset1() {
  $("#table_choice").val("Betafish")
  $("#pie_chart").empty();
  $("#data_table").empty();
}

function reset2() {
  $("#transposon_choice").val("LINE")
  $("#pie_chart_2").empty();
  $("#data_table_2").empty();
}



function download_csv_1(data){
  let csv1 = 'Transposon_Order,Count\n';
  data.forEach(item => {
    csv1 += `${item.Transposon_Order},${item.Total}\n`;
  });

  let link = document.createElement('a');
  link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv1);
  link.download = 'TransposonOrder_By_Species.csv';
  link.click();
}

function download_csv_2(data){
  let csv2 = 'Species,Count\n';
  data.forEach(item => {
    csv2 += `${item.Species},${item.Count}\n`;
  });

  let link = document.createElement('a');
  link.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv2);
  link.download = 'Specific_TransposonOrder_Search.csv';
  link.click();
}


function download_piechart_1 () {
  if(!global_data1) {
    alert("There is no pie chart avaliable to download");
    return;
  }

  var pieChartsaving = pieChart.getChart();
  var imgURL = pieChartsaving.getImageURI();
  let link = document.createElement('a');
  link.href = imgURL;
  link.download = 'PieChart1_TransposonOrder_By_Species.png';
  link.click();

}


function download_piechart_2 () {
  if(!global_data2) {
    alert("There is not a pie chart avaliable for you to download");
    return;
  }

  var pieChartsaving2= pieChart_2.getChart();
  var imgURL = pieChartsaving2.getImageURI();
  let link = document.createElement('a');
  link.href = imgURL;
  link.download = 'PieChart2_TransposonOrder_By_Species.png';
  link.click();

}



//Load packages needed to produce the google charts visualizations
document.addEventListener('DOMContentLoaded', function() {
  google.charts.load('current', {'packages': ['corechart', 'controls']});
});

    </script>
</head>
<body>

<!-- Navbar (sit on top) -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-wide w3-padding w3-card">
    <a href="TDatabase.html" class="w3-bar-item w3-button w3-animate-zoom"><b>Transposon </b> Browser Home</a>
    <!-- Float links to the right. Hide them on small screens -->
    <div class="w3-right w3-hide-small">
      <a href="Team.html" class="w3-bar-item w3-button w3-animate-zoom">Meet the Team</a>
      <a href="search_class.html" class="w3-bar-item w3-button w3-animate-zoom">Search Transposon Class</a>
      <a href="search_order.html" class="w3-bar-item w3-button w3-animate-zoom">Search Transposon Order</a>
      <a href="search_database.html" class="w3-bar-item w3-button w3-animate-zoom">Search Species</a>
    </div>
  </div>
</div>

<!-- Header -->
<header class="w3-display-container w3-content w3-wide"  style="min-height:100%;" id="home">
 <center> <img class="w3-image w3-animate-zoom" src="https://bioed.bu.edu/images/students_23/Team_H/bg/order.png" alt="Image description"></center>
  <div class="w3-display-middle w3-margin-top w3-center">
    <h1 class="w3-xxlarge w3-text-white"><span class="w3-padding w3-black w3-opacity-min"><b>Search By Order</b></span> <span class="w3-hide-small w3-text-light-grey"></span></h1>
  </div>
</header>

<!-- Page content -->
<div class="w3-content w3-padding" style="max-width:1564px"><br>
  <div class = "columns-container">
    <div class = "left-column">
      <form onsubmit="event.preventDefault(); google_piechart()">
        <h2>Transposon Orders By Species</h2>
        <label for = "table_choice">Instructions: Please select which species you would like transposon orders displayed for:</label><br>
        <select id = 'table_choice' name = 'table_choice'>
          <option value = "Betafish">Betafish</option>
          <option value = "HumanT2T">HumanT2T</option>
          <option value = "Molerat">Molerat</option>
          <option value = "Pufferfish">Pufferfish</option>
        </select><br><br>
        <div class = "buttons_container" style = "display:inline-flex;">
          <button type="submit" >Submit</button><br>
          <button type = "button" onclick = "reset1()">Reset</button>
        </div>
        <button class="button" onclick = "download_csv_1(global_data1)">Download Table 1 CSV Information</button>
        <button class="button" onclick = "download_piechart_1()">Download Pie Chart 1</button>
      </form>
      <br>
      <div id="dashboard_div">
        <!--Divs that will hold the pie chart and table-->
        <label for = "total_filter_slider">Transposon Orders That Have A Count Between:</label>
        <div id="total_filter_slider"></div>
        <div>
          <div id = "pie_chart"></div>
          <div id = "data_table" style= "width: 800px;"></div>
        </div>
      </div>
    </div>

    <div class = "right-column">
      <form onsubmit="event.preventDefault(); google_piechart_2();">
        <h2 id="transposon_order_heading">Occurences of [your transposon order] within the Betta splendens, Takifugu rubripes, Heterocephalus
          glaber, and Homo sapiens species</h2> 
        <label for = "submit">Instructions: Please enter the transposon order of your choice in order to display the frequency of its occurence
          in a particular species.
          (Examples Include: LINE, SINE, DNA/Maverick): 
        </label>
        <input type='text' id='transposon_choice' name='transposon_choice', value = "LINE"><br><br>
        <div class = "buttons_container" style = "display:inline-flex;">
          <button type="submit" >Submit</button><br>
          <button type = "button" onclick = "reset2()">Reset</button>
        </div>
        <button class="btn btn-primary" onclick = "download_csv_2(global_data2)">Download Table 2 CSV Information</button>
        <button class="btn btn-primary" onclick = "download_piechart_2()">Download Pie Chart 2</button>
      </form>
      <div id="dashboard_div_2">
        <!--Divs that will hold the pie chart and table-->
        <br>
        <label for = "total_filter_slider_2">Species That Have a Count Between: </label>
        <div id="total_filter_slider_2"></div>
        <div">
          <div id = "pie_chart_2"></div>
          <div id = "data_table_2" style= "width: 800px;"></div> 
        </div> 
      </div>
    </div>
  </div>

  <br>  
<br>





<!-- Footer -->
<footer class="w3-center w3-black w3-padding-16">
  <p>This project was developed at Boston University as
        part of BF768 Biological Database Systems Course, Spring 2023,  Instructor: Dr. Gary Benson</p>
      <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/31/Boston_University_wordmark.svg/1000px-Boston_University_wordmark.svg.png?20200623211014" alt="H" width="120" height="50">
      <p>Last revised April 21, 2023</p>
  </footer>

</body>
</html>
